@{
    ViewData["Title"] = "Gesti√≥n de Mandatarias";
    // Recuperamos la lista o creamos una nueva para evitar errores de null
    List<Mandatarias> lista = ViewBag.ListaMandatarias as List<Mandatarias> ?? new List<Mandatarias>();
}

<style>
    /* REGLA UX 85 A√ëOS: Alto contraste y tama√±o grande */
    body {
        background-color: #f4f6f9; /* Fondo gris muy suave para descansar la vista */
    }

    .titulo-principal {
        font-family: 'Roboto', sans-serif;
        font-weight: 700;
        font-size: 2.5rem;
        color: #000;
        margin-bottom: 30px;
        border-bottom: 4px solid #0d6efd; /* L√≠nea gu√≠a visual */
        padding-bottom: 10px;
    }

    /* TABLA ROBUSTA */
    .tabla-accesible {
        background-color: #fff;
        font-size: 1.25rem; /* 20px base */
        border: 2px solid #000;
    }
    .tabla-accesible thead {
        background-color: #000;
        color: #fff;
    }
    .tabla-accesible th, .tabla-accesible td {
        padding: 15px; /* Espaciado generoso (Ley de Fitts) */
        vertical-align: middle;
    }

    /* BOTONES GIGANTES Y CLAROS */
    .btn-accion {
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 2px solid #000; /* Borde f√≠sico */
        box-shadow: 2px 2px 0px #000; /* Sombra s√≥lida retro */
    }
    .btn-accion:active {
        transform: translate(2px, 2px);
        box-shadow: none;
    }

    /* INPUTS EN EL MODAL */
    .form-control-accesible {
        font-size: 1.5rem;
        border: 3px solid #6c757d;
        height: auto;
        padding: 15px;
    }
    .form-control-accesible:focus {
        border-color: #ffc107; /* Amarillo brillante para foco */
        box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.5);
    }

    /* MENSAJE VAC√çO */
    .alerta-vacia {
        background-color: #fff3cd;
        border: 2px solid #ffecb5;
        padding: 40px;
        text-align: center;
        font-size: 1.5rem;
        color: #664d03;
        border-radius: 10px;
    }
</style>

<div class="container mt-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="titulo-principal">üè¢ GESTI√ìN DE MANDATARIAS</h2>
        <button type="button" class="btn btn-success btn-lg btn-accion py-3 px-4" onclick="abrirModalAgregar()">
            <i class="bi bi-plus-circle-fill me-2"></i> AGREGAR NUEVA
        </button>
    </div>

    @if (lista.Count > 0)
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover tabla-accesible">
                <thead>
                    <tr>
                        <th scope="col" style="width: 10%;">ID</th>
                        <th scope="col" style="width: 50%;">NOMBRE DE LA MANDATARIA</th>
                        <th scope="col" style="width: 40%; text-align: center;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in lista)
                    {
                        <tr>
                            <td>#@item.IdMandatarias</td>
                            <td><strong>@item.RazonSocial</strong></td>
                            <td class="text-center">
                                <button class="btn btn-warning btn-lg btn-accion me-2" 
                                        onclick="abrirModalEditar(@item.IdMandatarias, '@item.RazonSocial')">
                                    <i class="bi bi-pencil-square"></i> MODIFICAR
                                </button>
                                
                                <button class="btn btn-danger btn-lg btn-accion" 
                                        onclick="abrirModalEliminar(@item.IdMandatarias, '@item.RazonSocial')">
                                    <i class="bi bi-trash-fill"></i> ELIMINAR
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alerta-vacia">
            <i class="bi bi-info-circle-fill" style="font-size: 3rem;"></i><br><br>
            <strong>NO HAY MANDATARIAS CARGADAS.</strong><br>
            Presione el bot√≥n verde "AGREGAR NUEVA" para comenzar.
        </div>
    }
</div>

<div class="modal fade" id="modalGestion" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: 4px solid #000;">
            
            <form action="@Url.Action("ModificarMandataria", "TuControlador")" method="post">
                <input type="hidden" id="inputId" name="IdMandataria" value="0" />
                <input type="hidden" id="inputQueToco" name="QueToco" value="" />

                <div class="modal-header bg-light">
                    <h3 class="modal-title fw-bold" id="modalLabel">T√çTULO DIN√ÅMICO</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                
                <div class="modal-body p-4">
                    <div id="mensajeEliminar" class="alert alert-danger d-none text-center">
                        <h4 class="fw-bold">¬øEST√Å SEGURO?</h4>
                        <p class="fs-5">Se eliminar√° la mandataria: <strong id="nombreEliminarDisplay"></strong></p>
                    </div>

                    <div id="contenedorInputNombre">
                        <label for="inputNombre" class="form-label fs-4 fw-bold">Nombre de la Mandataria:</label>
                        <input type="text" class="form-control form-control-accesible" 
                               id="inputNombre" name="NombreMandataria" 
                               placeholder="Escriba el nombre aqu√≠..." autocomplete="off">
                    </div>
                </div>
                
                <div class="modal-footer p-3 bg-light d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary btn-lg btn-accion" data-bs-dismiss="modal">
                        ‚ùå CANCELAR
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg btn-accion px-5" id="btnConfirmar">
                        ‚úÖ ACEPTAR
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<script>
    // Referencias a elementos del DOM
    const modalElement = document.getElementById('modalGestion');
    const modalInstance = new bootstrap.Modal(modalElement);
    
    const tituloModal = document.getElementById('modalLabel');
    const inputId = document.getElementById('inputId');
    const inputQueToco = document.getElementById('inputQueToco');
    const inputNombre = document.getElementById('inputNombre');
    const contenedorNombre = document.getElementById('contenedorInputNombre');
    const mensajeEliminar = document.getElementById('mensajeEliminar');
    const nombreEliminarDisplay = document.getElementById('nombreEliminarDisplay');
    const btnConfirmar = document.getElementById('btnConfirmar');

    // Funci√≥n 1: Preparar Modal para AGREGAR
    function abrirModalAgregar() {
        // Resetear formulario
        inputId.value = 0;
        inputQueToco.value = "Agregar";
        inputNombre.value = "";
        
        // Ajustar UI
        tituloModal.innerText = "NUEVA MANDATARIA";
        tituloModal.className = "modal-title fw-bold text-success";
        
        contenedorNombre.classList.remove('d-none');
        mensajeEliminar.classList.add('d-none');
        
        btnConfirmar.className = "btn btn-success btn-lg btn-accion px-5";
        btnConfirmar.innerHTML = "üíæ GUARDAR";

        // Abrir y poner foco (Espera 500ms para asegurar que el modal renderiz√≥)
        modalInstance.show();
        setTimeout(() => inputNombre.focus(), 500);
    }

    // Funci√≥n 2: Preparar Modal para MODIFICAR
    function abrirModalEditar(id, nombreActual) {
        inputId.value = id;
        inputQueToco.value = "Modificar";
        inputNombre.value = nombreActual;

        tituloModal.innerText = "EDITAR MANDATARIA";
        tituloModal.className = "modal-title fw-bold text-warning";

        contenedorNombre.classList.remove('d-none');
        mensajeEliminar.classList.add('d-none');

        btnConfirmar.className = "btn btn-warning btn-lg btn-accion px-5";
        btnConfirmar.innerHTML = "üíæ ACTUALIZAR";

        modalInstance.show();
        setTimeout(() => inputNombre.focus(), 500);
    }

    // Funci√≥n 3: Preparar Modal para ELIMINAR
    function abrirModalEliminar(id, nombre) {
        inputId.value = id;
        inputQueToco.value = "Eliminar";
        inputNombre.value = nombre; // Se env√≠a aunque no se muestre, por si acaso

        tituloModal.innerText = "ELIMINAR MANDATARIA";
        tituloModal.className = "modal-title fw-bold text-danger";

        contenedorNombre.classList.add('d-none'); // Ocultar input
        mensajeEliminar.classList.remove('d-none'); // Mostrar advertencia
        nombreEliminarDisplay.innerText = nombre;

        btnConfirmar.className = "btn btn-danger btn-lg btn-accion px-5";
        btnConfirmar.innerHTML = "üóëÔ∏è SI, ELIMINAR";

        modalInstance.show();
    }
</script>